<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>看见</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="css/css.css" rel="stylesheet">
    <!-- <link href="css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="index2">
    <div class="logo">
        <img src="images/logo2.jpg" alt="">
    </div>
    <div class="container">
        <div class="app-rewards-color">
            <h4 class="title">您已领取的返利余额</h4>
            <div>
                <span id="amount">0</span>元
            </div>
        </div>
        <table class="table table-condensed" id="list">
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="modal fade " id="myModal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">分享</h4>
                </div>
                <div class="modal-body">
                    <p>亲，也许您的朋友也有许多现金返利因未被领取而过期，提现一下他们吧！</p>
                    <button type="button" class="btn btn-success">先告诉我的朋友</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <script id="tr-template" type="text/x-handlebars-template">
        {{#each rewards}}
        <tr class="warning">
            <td>{{year}}.{{month}}</td>
            <td>{{amount}}元</td>
            <td><span class="row-{{type}}">
                    {{#if_eq type "valid"}}
                        可领取
                    {{else}}
                    {{/if_eq}}
                    {{#if_eq type "expired"}}
                        已过期
                    {{else}}
                    {{/if_eq}}
                    {{#if_eq type "invalid"}}
                        未结算
                    {{else}}
                    {{/if_eq}}
                </td> 
            </tr>
        {{/each}}
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- <script src="js/bootstrap.min.js"></script> -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/handlebars.js/4.0.2/handlebars.min.js"></script>
    <script>
    //显示用户的返利、提示分享

    //根据用户id获取返利信息
    //微信分享js 分享成功后出现app下载链接 （这里有下载统计）


    // var urlRoot = "http://data.800-taobao.com/api/v2/";
    var urlRoot = "http://localhost:3000/api/v2/";



    Handlebars.registerHelper('if_eq', function(a, b, opts) {
        if(a == b) // Or === depending on your needs
            return opts.fn(this);
        else
            return opts.inverse(this);
    });
    $.support.transition = false;

    jQuery(document).ready(function($) {
        $('#myModal').modal()  ;

        $('#myModal').on('shown.bs.modal', function() {
            $(this).find('.modal-dialog').css({
                'margin-top': function () {
                    return ($(this).outerHeight() / 2);
                },
            });
        });


        var userid = location.hash.replace("#", "");
        $.get(urlRoot + 'Reward' + "/" + userid, function(data, textStatus, xhr) {
            /*optional stuff to do after success */
            var source   = $("#tr-template").html();
            var template = Handlebars.compile(source);

            var rewards = [];
            

            for (var i = data.rewards.length - 1; i >= 0; i--) {
                rewards.push(data.rewards[i]);

            };
            var amount = data.rewards[0].amount;
            data.rewards = rewards;

            var now = new Date();
            var year = now.getFullYear();
            var month = now.getMonth()+2;
            var reward = {
                "amount": 0,
                "month": month,
                "year": year,
                "type": "invalid"
            };
            data.rewards.push(reward);
            $("#amount").html(amount);
            var html    = template(data);
            $("#list tbody").html(html);


        });
    });
    </script>
</body>

</html>
